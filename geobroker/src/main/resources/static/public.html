<!DOCTYPE html>
<!--
  ~ Copyright (c) 2018 Red Cross Vienna and contributors. All rights reserved.
  ~
  ~ This software may be modified and distributed under the terms of the MIT license. See the LICENSE file for details.
  -->

<html>
<head>
  <title>GeoBroker live map</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <link rel="stylesheet" href="libs/leaflet/v1.3.1/leaflet.css" />

  <script src="libs/leaflet/v1.3.1/leaflet.js"></script>

  <style>
      body {
        padding: 0;
        margin: 0;
      }
      html, body, #map {
        height: 100%;
        width: 100vw;
      }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
      var map = L.map('map').fitWorld();
      var marker = L.marker([0,0]).addTo(map);
      var circle = L.circle([0,0], 0).addTo(map);

      L.tileLayer('https://{s}.wien.gv.at/basemap/bmaphidpi/normal/google3857/{z}/{y}/{x}.jpeg', {
        maxZoom: 19,
        subdomains: ['maps', 'maps1', 'maps2', 'maps3', 'maps4'],
        bounds: [[46.358770, 8.782379], [49.037872, 17.189532]],
        attribution: 'Grundkarte: <a href="http://basemap.at" target="_blank">basemap.at</a>, <a href="http://creativecommons.org/licenses/by/3.0/at/deed.de" target="_blank">CC-BY 3.0</a>',
      }).addTo(map);

      function onLocationFound(e) {
        var radius = e.accuracy / 2;

        /*L.marker(e.latlng).addTo(map)
          .bindPopup("You are within " + radius + " meters from this point").openPopup();*/
        marker.setLatLng(e.latlng);

        /*L.circle(e.latlng, radius).addTo(map);*/
        circle.setRadius(radius).setLatLng(e.latlng);
      }

      function onLocationError(e) {
        alert(e.message);
      }

      map.on('locationfound', onLocationFound);
      map.on('locationerror', onLocationError);

      map.locate({setView: true, watch: true, enableHighAccuracy: true, maxZoom: 16});
  </script>
</body>
</html>
